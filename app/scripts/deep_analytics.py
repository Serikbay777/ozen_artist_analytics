import pandas as pd
import numpy as np
from datetime import datetime
import warnings
warnings.filterwarnings('ignore')

# –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
print("üì• –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...")
df = pd.read_pickle('/Users/nuraliserikbay/Desktop/codes/music_analyzer_agent/data/processed/all_believe_data.pkl')

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
df['year'] = df['–ú–µ—Å—è—Ü –æ—Ç—á–µ—Ç–∞'].dt.year
df['month'] = df['–ú–µ—Å—è—Ü –æ—Ç—á–µ—Ç–∞'].dt.month
df['quarter'] = df['–ú–µ—Å—è—Ü –æ—Ç—á–µ—Ç–∞'].dt.quarter
df['year_month'] = df['–ú–µ—Å—è—Ü –æ—Ç—á–µ—Ç–∞'].dt.to_period('M')

total_revenue = df['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'].sum()
total_streams = df['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'].sum()

print("=" * 80)
print("üéµ –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ú–£–ó–´–ö–ê–õ–¨–ù–û–ì–û –ö–ê–¢–ê–õ–û–ì–ê")
print("=" * 80)

# ============================================================================
# 1. –¢–û–ü –¢–†–ï–ö–ò
# ============================================================================
print("\n" + "=" * 80)
print("üèÜ –¢–û–ü-20 –¢–†–ï–ö–û–í –ü–û –í–´–†–£–ß–ö–ï")
print("=" * 80)

top_tracks = df.groupby(['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']).agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()
top_tracks['CPM'] = (top_tracks['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / top_tracks['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] * 1000)
top_tracks = top_tracks.sort_values('–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è', ascending=False).head(20)

for idx, row in top_tracks.iterrows():
    pct = (row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / total_revenue) * 100
    print(f"{row['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å']} - {row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']}")
    print(f"   üí∞ ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.2f} ({pct:.2f}%) | üéß {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.1f}M —Å—Ç—Ä–∏–º–æ–≤ | CPM: ‚Ç¨{row['CPM']:.3f}")

# ============================================================================
# 2. –¢–û–ü –¢–†–ï–ö–ò –ü–û –°–¢–†–ò–ú–ê–ú (VIRAL HITS)
# ============================================================================
print("\n" + "=" * 80)
print("üî• –¢–û–ü-20 –¢–†–ï–ö–û–í –ü–û –°–¢–†–ò–ú–ê–ú (VIRAL –•–ò–¢–´)")
print("=" * 80)

viral_tracks = df.groupby(['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']).agg({
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum',
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum'
}).reset_index()
viral_tracks['CPM'] = (viral_tracks['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / viral_tracks['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] * 1000)
viral_tracks = viral_tracks.sort_values('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', ascending=False).head(20)

for idx, row in viral_tracks.iterrows():
    pct = (row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] / total_streams) * 100
    print(f"{row['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å']} - {row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']}")
    print(f"   üéß {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.1f}M —Å—Ç—Ä–∏–º–æ–≤ ({pct:.2f}%) | üí∞ ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.2f} | CPM: ‚Ç¨{row['CPM']:.3f}")

# ============================================================================
# 3. –°–ï–ó–û–ù–ù–û–°–¢–¨
# ============================================================================
print("\n" + "=" * 80)
print("üìÖ –°–ï–ó–û–ù–ù–û–°–¢–¨ –ò –¢–†–ï–ù–î–´")
print("=" * 80)

# –ü–æ –º–µ—Å—è—Ü–∞–º
monthly = df.groupby('month').agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()
monthly['CPM'] = (monthly['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / monthly['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] * 1000)

months_ru = {1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å', 5: '–ú–∞–π', 6: '–ò—é–Ω—å',
             7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç', 9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'}

print("\nüìä –°–†–ï–î–ù–Ø–Ø –í–´–†–£–ß–ö–ê –ü–û –ú–ï–°–Ø–¶–ê–ú:")
for _, row in monthly.iterrows():
    month_name = months_ru[row['month']]
    print(f"   {month_name}: ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.0f} | {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.1f}M —Å—Ç—Ä–∏–º–æ–≤ | CPM: ‚Ç¨{row['CPM']:.3f}")

# –ü–æ –∫–≤–∞—Ä—Ç–∞–ª–∞–º
quarterly = df.groupby(['year', 'quarter']).agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()

print("\nüìä –î–ò–ù–ê–ú–ò–ö–ê –ü–û –ö–í–ê–†–¢–ê–õ–ê–ú:")
for _, row in quarterly.iterrows():
    print(f"   {int(row['year'])} Q{int(row['quarter'])}: ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.0f} | {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.1f}M —Å—Ç—Ä–∏–º–æ–≤")

# ============================================================================
# 4. –ì–ï–û–ì–†–ê–§–ò–Ø - CPM –ò –í–´–†–£–ß–ö–ê –ü–û –°–¢–†–ê–ù–ê–ú
# ============================================================================
print("\n" + "=" * 80)
print("üåç –ì–ï–û–ì–†–ê–§–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó")
print("=" * 80)

countries = df.groupby('—Å—Ç—Ä–∞–Ω–∞ / —Ä–µ–≥–∏–æ–Ω').agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()
countries['CPM'] = (countries['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / countries['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] * 1000)
countries = countries[countries['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] > 10000]  # –§–∏–ª—å—Ç—Ä –º–∏–Ω–∏–º—É–º 10k —Å—Ç—Ä–∏–º–æ–≤

print("\nüí∞ –¢–û–ü-15 –°–¢–†–ê–ù –ü–û –í–´–†–£–ß–ö–ï:")
top_countries_rev = countries.sort_values('–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è', ascending=False).head(15)
for _, row in top_countries_rev.iterrows():
    pct = (row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / total_revenue) * 100
    print(f"   {row['—Å—Ç—Ä–∞–Ω–∞ / —Ä–µ–≥–∏–æ–Ω']}: ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.0f} ({pct:.2f}%) | CPM: ‚Ç¨{row['CPM']:.3f}")

print("\nüíé –¢–û–ü-15 –°–¢–†–ê–ù –ü–û CPM (–º–∏–Ω. 10k —Å—Ç—Ä–∏–º–æ–≤):")
top_countries_cpm = countries.sort_values('CPM', ascending=False).head(15)
for _, row in top_countries_cpm.iterrows():
    print(f"   {row['—Å—Ç—Ä–∞–Ω–∞ / —Ä–µ–≥–∏–æ–Ω']}: ‚Ç¨{row['CPM']:.3f} | ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.0f} | {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.2f}M —Å—Ç—Ä–∏–º–æ–≤")

# ============================================================================
# 5. –†–û–°–¢ –ê–†–¢–ò–°–¢–û–í
# ============================================================================
print("\n" + "=" * 80)
print("üìà –†–û–°–¢ –ê–†–¢–ò–°–¢–û–í (YoY)")
print("=" * 80)

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ 2023 vs 2024
artists_2023 = df[df['year'] == 2023].groupby('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å')['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'].sum()
artists_2024 = df[df['year'] == 2024].groupby('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å')['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'].sum()

growth_df = pd.DataFrame({
    '2023': artists_2023,
    '2024': artists_2024
}).fillna(0)

growth_df['Growth'] = ((growth_df['2024'] - growth_df['2023']) / growth_df['2023'] * 100).replace([np.inf, -np.inf], 0)
growth_df['Abs_Growth'] = growth_df['2024'] - growth_df['2023']

# –¢–æ–ø –ø–æ –∞–±—Å–æ–ª—é—Ç–Ω–æ–º—É —Ä–æ—Å—Ç—É (–∫—Ç–æ –±—ã–ª –∏ –≤ 2023, –∏ –≤ 2024)
print("\nüöÄ –¢–û–ü-15 –ü–û –ê–ë–°–û–õ–Æ–¢–ù–û–ú–£ –†–û–°–¢–£ (2023‚Üí2024):")
top_growth = growth_df[(growth_df['2023'] > 0) & (growth_df['2024'] > 0)].sort_values('Abs_Growth', ascending=False).head(15)
for artist, row in top_growth.iterrows():
    print(f"   {artist}")
    print(f"      2023: ‚Ç¨{row['2023']:,.0f} ‚Üí 2024: ‚Ç¨{row['2024']:,.0f} ({row['Growth']:+.1f}%)")

# –ù–æ–≤—ã–µ –∑–≤–µ–∑–¥—ã 2024
print("\n‚≠ê –ù–û–í–´–ï –ó–í–ï–ó–î–´ 2024 (–Ω–µ –±—ã–ª–æ –≤ 2023, —Ç–æ–ø-15):")
new_stars = growth_df[(growth_df['2023'] == 0) & (growth_df['2024'] > 1000)].sort_values('2024', ascending=False).head(15)
for artist, row in new_stars.iterrows():
    print(f"   {artist}: ‚Ç¨{row['2024']:,.0f}")

# ============================================================================
# 6. –ê–ù–ê–õ–ò–ó –ê–†–¢–ò–°–¢–û–í - –î–ò–í–ï–†–°–ò–§–ò–ö–ê–¶–ò–Ø
# ============================================================================
print("\n" + "=" * 80)
print("üé§ –î–ò–í–ï–†–°–ò–§–ò–ö–ê–¶–ò–Ø –ê–†–¢–ò–°–¢–û–í")
print("=" * 80)

artist_diversity = df.groupby('–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å').agg({
    '–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞': 'nunique',
    '—Å—Ç—Ä–∞–Ω–∞ / —Ä–µ–≥–∏–æ–Ω': 'nunique',
    '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞': 'nunique',
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()
artist_diversity.columns = ['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ü–ª–∞—Ç—Ñ–æ—Ä–º', '–°—Ç—Ä–∞–Ω', '–¢—Ä–µ–∫–æ–≤', '–í—ã—Ä—É—á–∫–∞', '–°—Ç—Ä–∏–º—ã']
artist_diversity = artist_diversity.sort_values('–í—ã—Ä—É—á–∫–∞', ascending=False).head(20)

print("\n–¢–û–ü-20 –ê–†–¢–ò–°–¢–û–í - –û–•–í–ê–¢:")
for _, row in artist_diversity.iterrows():
    print(f"{row['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å']}")
    print(f"   üí∞ ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞']:,.0f} | üéµ {row['–¢—Ä–µ–∫–æ–≤']} —Ç—Ä–µ–∫–æ–≤ | üì± {row['–ü–ª–∞—Ç—Ñ–æ—Ä–º']} –ø–ª–∞—Ç—Ñ–æ—Ä–º | üåç {row['–°—Ç—Ä–∞–Ω']} —Å—Ç—Ä–∞–Ω")

# ============================================================================
# 7. –ü–õ–ê–¢–§–û–†–ú–´ - –†–û–°–¢ –ò –î–ò–ù–ê–ú–ò–ö–ê
# ============================================================================
print("\n" + "=" * 80)
print("üì± –î–ò–ù–ê–ú–ò–ö–ê –ü–õ–ê–¢–§–û–†–ú")
print("=" * 80)

platforms_yearly = df.groupby(['–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞', 'year'])['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'].sum().reset_index()
platforms_pivot = platforms_yearly.pivot(index='–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞', columns='year', values='–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è').fillna(0)

# –†–æ—Å—Ç 2023‚Üí2024
if 2023.0 in platforms_pivot.columns and 2024.0 in platforms_pivot.columns:
    platforms_pivot['Growth_2024'] = ((platforms_pivot[2024.0] - platforms_pivot[2023.0]) / platforms_pivot[2023.0] * 100).replace([np.inf, -np.inf], 0)
    platforms_pivot['Abs_Growth'] = platforms_pivot[2024.0] - platforms_pivot[2023.0]
    
    print("\nüöÄ –¢–û–ü-15 –ü–õ–ê–¢–§–û–†–ú –ü–û –†–û–°–¢–£ (2023‚Üí2024):")
    top_platform_growth = platforms_pivot[platforms_pivot[2023.0] > 1000].sort_values('Abs_Growth', ascending=False).head(15)
    for idx, row in top_platform_growth.iterrows():
        print(f"   {idx}")
        print(f"      2023: ‚Ç¨{row[2023.0]:,.0f} ‚Üí 2024: ‚Ç¨{row[2024.0]:,.0f} ({row['Growth_2024']:+.1f}%)")

# ============================================================================
# 8. –¢–ò–ü –ü–†–û–î–ê–ñ–ò
# ============================================================================
print("\n" + "=" * 80)
print("üíø –ê–ù–ê–õ–ò–ó –¢–ò–ü–û–í –ü–†–û–î–ê–ñ")
print("=" * 80)

sale_types = df.groupby('–¢–∏–ø –ø—Ä–æ–¥–∞–∂–∏').agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()
sale_types['CPM'] = (sale_types['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / sale_types['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] * 1000)

print("\n–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ü–û –¢–ò–ü–ê–ú:")
for _, row in sale_types.iterrows():
    rev_pct = (row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'] / total_revenue) * 100
    stream_pct = (row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] / total_streams) * 100
    print(f"   {row['–¢–∏–ø –ø—Ä–æ–¥–∞–∂–∏']}: ‚Ç¨{row['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è']:,.0f} ({rev_pct:.1f}%) | {row['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ']/1e6:.1f}M ({stream_pct:.1f}%) | CPM: ‚Ç¨{row['CPM']:.3f}")

# ============================================================================
# 9. –õ–ï–ô–ë–õ–´
# ============================================================================
print("\n" + "=" * 80)
print("üè¢ –ê–ù–ê–õ–ò–ó –õ–ï–ô–ë–õ–û–í")
print("=" * 80)

labels = df.groupby('–õ–µ–π–±–ª').agg({
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum',
    '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å': 'nunique',
    '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞': 'nunique'
}).reset_index()
labels.columns = ['–õ–µ–π–±–ª', '–í—ã—Ä—É—á–∫–∞', '–°—Ç—Ä–∏–º—ã', '–ê—Ä—Ç–∏—Å—Ç–æ–≤', '–¢—Ä–µ–∫–æ–≤']
labels['CPM'] = (labels['–í—ã—Ä—É—á–∫–∞'] / labels['–°—Ç—Ä–∏–º—ã'] * 1000)
labels['–í—ã—Ä—É—á–∫–∞_–Ω–∞_–∞—Ä—Ç–∏—Å—Ç–∞'] = labels['–í—ã—Ä—É—á–∫–∞'] / labels['–ê—Ä—Ç–∏—Å—Ç–æ–≤']
labels = labels.sort_values('–í—ã—Ä—É—á–∫–∞', ascending=False)

print("\n–¢–û–ü-10 –õ–ï–ô–ë–õ–û–í:")
for _, row in labels.head(10).iterrows():
    pct = (row['–í—ã—Ä—É—á–∫–∞'] / total_revenue) * 100
    print(f"{row['–õ–µ–π–±–ª']}")
    print(f"   üí∞ ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞']:,.0f} ({pct:.1f}%) | üé§ {row['–ê—Ä—Ç–∏—Å—Ç–æ–≤']} –∞—Ä—Ç–∏—Å—Ç–æ–≤ | üéµ {row['–¢—Ä–µ–∫–æ–≤']} —Ç—Ä–µ–∫–æ–≤")
    print(f"   üìä CPM: ‚Ç¨{row['CPM']:.3f} | ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞_–Ω–∞_–∞—Ä—Ç–∏—Å—Ç–∞']:,.0f}/–∞—Ä—Ç–∏—Å—Ç")

# ============================================================================
# 10. –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –¢–†–ï–ö–û–í
# ============================================================================
print("\n" + "=" * 80)
print("‚è≥ –ñ–ò–ó–ù–ï–ù–ù–´–ô –¶–ò–ö–õ –¢–†–ï–ö–û–í")
print("=" * 80)

track_lifecycle = df.groupby(['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']).agg({
    'year_month': ['min', 'max', 'nunique'],
    '–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è': 'sum',
    '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': 'sum'
}).reset_index()

track_lifecycle.columns = ['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞', '–ü–µ—Ä–≤—ã–π_–º–µ—Å—è—Ü', '–ü–æ—Å–ª–µ–¥–Ω–∏–π_–º–µ—Å—è—Ü', '–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω', '–í—ã—Ä—É—á–∫–∞', '–°—Ç—Ä–∏–º—ã']
track_lifecycle['–í—ã—Ä—É—á–∫–∞_–≤_–º–µ—Å—è—Ü'] = track_lifecycle['–í—ã—Ä—É—á–∫–∞'] / track_lifecycle['–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω']

print("\n–¢–û–ü-15 –î–û–õ–ì–û–ò–ì–†–ê–Æ–©–ò–• –¢–†–ï–ö–û–í (–ø–æ –º–µ—Å—è—Ü–∞–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏):")
long_tracks = track_lifecycle[track_lifecycle['–í—ã—Ä—É—á–∫–∞'] > 1000].sort_values('–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω', ascending=False).head(15)
for _, row in long_tracks.iterrows():
    print(f"{row['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å']} - {row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']}")
    print(f"   ‚è±Ô∏è  {row['–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω']} –º–µ—Å—è—Ü–µ–≤ | üí∞ ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞']:,.0f} (‚Ç¨{row['–í—ã—Ä—É—á–∫–∞_–≤_–º–µ—Å—è—Ü']:,.0f}/–º–µ—Å)")

print("\n–¢–û–ü-15 –°–ê–ú–´–• –ü–†–ò–ë–´–õ–¨–ù–´–• –í –ú–ï–°–Ø–¶:")
profitable_tracks = track_lifecycle[track_lifecycle['–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω'] >= 3].sort_values('–í—ã—Ä—É—á–∫–∞_–≤_–º–µ—Å—è—Ü', ascending=False).head(15)
for _, row in profitable_tracks.iterrows():
    print(f"{row['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å']} - {row['–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞']}")
    print(f"   üí∞ ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞_–≤_–º–µ—Å—è—Ü']:,.0f}/–º–µ—Å | ‚è±Ô∏è  {row['–ú–µ—Å—è—Ü–µ–≤_–∞–∫—Ç–∏–≤–µ–Ω']} –º–µ—Å—è—Ü–µ–≤ | –í—Å–µ–≥–æ: ‚Ç¨{row['–í—ã—Ä—É—á–∫–∞']:,.0f}")

# ============================================================================
# 11. –ö–û–ù–¶–ï–ù–¢–†–ê–¶–ò–Ø –ü–û –¢–†–ï–ö–ê–ú
# ============================================================================
print("\n" + "=" * 80)
print("üéØ –ö–û–ù–¶–ï–ù–¢–†–ê–¶–ò–Ø –í–´–†–£–ß–ö–ò –ü–û –¢–†–ï–ö–ê–ú")
print("=" * 80)

track_revenue = df.groupby(['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å', '–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞'])['–°—É–º–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è'].sum().sort_values(ascending=False)
top_10_tracks = track_revenue.head(10).sum()
top_50_tracks = track_revenue.head(50).sum()
top_100_tracks = track_revenue.head(100).sum()

print(f"\n–¢–æ–ø-10 —Ç—Ä–µ–∫–æ–≤: ‚Ç¨{top_10_tracks:,.0f} ({top_10_tracks/total_revenue*100:.1f}%)")
print(f"–¢–æ–ø-50 —Ç—Ä–µ–∫–æ–≤: ‚Ç¨{top_50_tracks:,.0f} ({top_50_tracks/total_revenue*100:.1f}%)")
print(f"–¢–æ–ø-100 —Ç—Ä–µ–∫–æ–≤: ‚Ç¨{top_100_tracks:,.0f} ({top_100_tracks/total_revenue*100:.1f}%)")
print(f"–í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–µ–∫–æ–≤: {len(track_revenue)}")

print("\n" + "=" * 80)
print("‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù")
print("=" * 80)

